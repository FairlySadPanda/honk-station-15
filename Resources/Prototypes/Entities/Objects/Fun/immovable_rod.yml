- type: entity
  id: ImmovableRodBase
  abstract: true
  components:
  - type: Clickable
  - type: InteractionOutline
  - type: MovementIgnoreGravity
    weightless: true
  - type: Sprite
    sprite: Objects/Fun/immovable_rod.rsi
    state: icon
    noRot: false
  - type: Physics
    bodyType: Dynamic
    linearDamping: 0
    bodyStatus: InAir
  - type: TileFrictionModifier
    modifier: 0
  - type: PointLight
    radius: 3
    color: red
    energy: 2.0
  # Rods collide with solid objects.
  - type: Fixtures
    fixtures:
      immovablerod:
        shape:
          !type:PhysShapeCircle
          radius: 0.5
        density: 1
        hard: false
        layer:
        - Impassable
        - Opaque
        mask:
        - Impassable
        - Opaque
  # Allow the rod to do things when it hits things.
  # TODO: make sure that it only hits each entity once.
  - type: TriggerOnCollide
    fixtureID: immovablerod
    keyOut: OnCollide
  # Allow the rod to do things when it spawns.
  - type: TriggerOnSpawn
    keyOut: OnSpawn
  # All rods CLANG when they hit things.
  - type: EmitSoundOnTrigger
    sound:
      collection: MetalSlam
    keysIn:
      - OnCollide

- type: entity
  id: ImmovableRod
  name: immovable rod
  parent: ImmovableRodBase
  description: You didn't need those walls anyway. Or your spleen.
  components:
  - type: WarpPoint
    follow: true
    location: immovable rod
    blacklist:
      tags:
      - GhostOnlyWarp
  # When the rod hits things it does damage. It does way more to
  # structures. It does piercing, which is a damage type that also
  # applies a bleeding DOT effect on the target, so the damage here
  # isn't reflective of the total danger posed to mobs.
  - type: DamageOnTrigger
    ignoreResistances: true
    targetUser: true
    damage:
      types:
        Blunt: 40 # MY BONES!
        Piercing: 45 # MY SPLEEN!
        Structural: 1000 # MY CAR!
    keysIn:
      - OnCollide
  # Rods stun anything they hit, and this should put almost any normal
  # mob into stamcrit state.
  - type: StaminaDamageOnTrigger
    stamina: 200
    ignoreResistances: true
    targetUser: true
    keysIn:
      - OnCollide

# Wizards can polymorph into Immovable Rods, which work similarly to their
# true counterparts, but can be "flown" by the controlling wizard.
- type: entity
  parent: ImmovableRodBase
  id: ImmovableRodWizard
  name: Rodney's Dramatic Entrance
  description: Did you know that this spell was originally invented by a wizard called Rodney because everyone kept making fun of his name? Now you do. Anyway, if you've stopped to read this description, you're probably dead.
  suffix: Wizard
  components:
  - type: InputMover
  - type: MovementSpeedModifier
    baseWeightlessAcceleration: 5
    baseWeightlessModifier: 2
    baseWeightlessFriction: 0
    baseFriction: 0
    offGridFriction: 0
  - type: CanMoveInAir
  - type: MovementAlwaysTouching
  - type: NoSlip
  # Wizard rods are still ruinous to structures, but do a little less damage to
  # mobs.
  - type: DamageOnTrigger
    ignoreResistances: true
    targetUser: true
    damage:
      types:
        Blunt: 30 # MY BONES!
        Piercing: 35 # MY SPLEEN!
        Structural: 1000 # MY CAR!
    keysIn:
      - OnCollide
  # Wizard rods stun people just as well as normal rods.
  - type: StaminaDamageOnTrigger
    stamina: 200
    ignoreResistances: true
    targetUser: true
    keysIn:
      - OnCollide
  # When a wizard rod is spawned, it is launched at some speed in its spawned direction.
  # We're making an assumption here that the polymorph or other spawn code can set the
  # rotation properly.
  - type: LaunchOnTrigger
    speed: 15.0
    keysIn:
      - OnSpawn

- type: entity
  parent: ImmovableRod
  id: ImmovableRodMop
  name: immovable mop
  description: Hurled like a javelin, with the power of a thousand furious janitors.
  components:
  - type: Sprite
    sprite: Objects/Specific/Janitorial/mop.rsi
    state: mop
    rotation: 225
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodShark
  name: immovable shark
  description: SHARK TORNADO!
  components:
  - type: Sprite
    sprite: Objects/Fun/Plushies/shark.rsi
    state: blue
    rotation: 90
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodClown
  name: immovable clown
  description: Ejected from the neighbouring station one solar system over. HONK!
  components:
  - type: Sprite
    sprite: Markers/jobs.rsi
    state: clown
    rotation: 180
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodBanana
  name: immovable banana
  description: At least you won't slip on it.
  components:
  - type: Sprite
    sprite: Objects/Specific/Hydroponics/banana.rsi
    state: produce
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodHammer
  name: immovable hammer
  description: Bwoink.
  components:
  - type: Sprite
    sprite: Objects/Weapons/Melee/sledgehammer.rsi
    state: icon
    rotation: 225
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodThrongler
  name: immovable throngler
  description: If you catch it, you can keep it.
  components:
  - type: Sprite
    sprite: Objects/Weapons/Melee/Throngler2.rsi
    state: icon
    rotation: 225
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodGibstick
  name: immovable gibstick
  description: What did you expect?
  components:
  - type: Sprite
    sprite: Objects/Weapons/Melee/debug.rsi
    state: icon
    rotation: 225
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodWeh
  name: immovable weh
  description: WEH!
  components:
  - type: Sprite
    sprite: Objects/Fun/Plushies/lizard.rsi
    state: icon
    noRot: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodSus
  name: immovable among peque√±o
  description: They were not the impostor.
  components:
  - type: Sprite
    sprite: Objects/Fun/pequeno.rsi
    layers:
    - state: base
      map: [ "enum.DamageStateVisualLayers.Base" ]
    - state: visor

- type: entity
  parent: ImmovableRod
  id: ImmovableRodSpear
  name: immovable spear
  description: Legends say this was thrown into orbit by the biggest chungus on Planet Wawa, shortly before a long nap.
  components:
  - type: Sprite
    sprite: Objects/Weapons/Melee/spear.rsi
    layers:
    - state: spear
    - state: spear1
      map: ["enum.SolutionContainerLayers.Fill"]
      visible: false

- type: entity
  parent: ImmovableRod
  id: ImmovableRodToolbox
  name: the robustest toolbox
  description: Garbage collection!!
  components:
  - type: Sprite
    sprite: Objects/Tools/Toolboxes/toolbox_blue.rsi
    state: icon
